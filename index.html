<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>è¿½å‰§æ—¥åŽ†</title>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#0b1220;
  color:white;
}

header{
  text-align:center;
  padding:20px;
}

.calendar{
  max-width:1000px;
  margin:auto;
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  padding:20px;
}

.day{
  background:#1e293b;
  min-height:70px;
  font-size:12px;
  padding:4px;
  border-radius:6px;
  overflow:hidden;
}

.has-update{
  background:#2563eb;
}

.today{
  border:2px solid #22c55e;
}

</style>
</head>

<body>

<header>
  <h2>ðŸ“… è¿½å‰§æ—¥åŽ†</h2>
</header>

<div class="calendar" id="calendar"></div>

<script>

let data = [];

fetch('data.json')
.then(res => res.json())
.then(json => {
  data = json;
  renderCalendar();
});

function renderCalendar(){

  const calendar = document.getElementById('calendar');
  calendar.innerHTML = "";

  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth();

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month+1, 0).getDate();

  for(let i=0;i<firstDay;i++){
    calendar.innerHTML += "<div></div>";
  }

  for(let day=1; day<=daysInMonth; day++){

    let dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;

    let dayShows = data.filter(show => {
      let premiere = new Date(show.premiereDate);
      let current = new Date(dateStr);
      let diffDays = (current - premiere) / (1000*60*60*24);

      return diffDays >= 0 && diffDays % show.updateInterval === 0;
    });

    let className = "day";

    if(dayShows.length > 0) className += " has-update";

    let todayStr = today.toISOString().split('T')[0];
    if(dateStr === todayStr) className += " today";

    let content = dayShows.map(s => s.name).join("<br>");

    calendar.innerHTML += `
      <div class="${className}">
        ${day}<br>
        ${content}
      </div>
    `;
  }
}

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>è¿½å‰§æ—¥åŽ†</title>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#0b1220;
  color:white;
}

header{
  text-align:center;
  padding:30px 20px;
}

button{
  background:#1e293b;
  color:white;
  border:none;
  padding:8px 14px;
  margin:5px;
  border-radius:6px;
  cursor:pointer;
}

.calendar{
  max-width:900px;
  margin:auto;
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:5px;
  padding:20px;
}

.day{
  background:#1e293b;
  min-height:80px;
  padding:5px;
  border-radius:8px;
  font-size:14px;
}

.highlight{
  background:#2563eb;
}

.today{
  border:2px solid #22c55e;
}

#events{
  max-width:900px;
  margin:20px auto;
  padding:20px;
  background:#1e293b;
  border-radius:10px;
}
</style>
</head>

<body>

<header>
  <h1>ðŸ“… è¿½å‰§æ—¥åŽ†</h1>
  <div>
    <button onclick="changeMonth(-1)">â¬… ä¸Šæœˆ</button>
    <span id="monthTitle"></span>
    <button onclick="changeMonth(1)">ä¸‹æœˆ âž¡</button>
  </div>
</header>

<div class="calendar" id="calendar"></div>

<div id="events">
  ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹æ›´æ–°
</div>

<script>

let currentDate = new Date();

let data = [];

fetch('data.json')
  .then(res => res.json())
  .then(json => {
    data = json;
    renderCalendar();
  });

function changeMonth(offset){
  currentDate.setMonth(currentDate.getMonth()+offset);
  renderCalendar();
}

function renderCalendar(){

  const calendar = document.getElementById('calendar');
  const monthTitle = document.getElementById('monthTitle');
  const events = document.getElementById('events');

  calendar.innerHTML = "";

  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();

  monthTitle.innerText = year + " å¹´ " + (month+1) + " æœˆ";

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month+1, 0).getDate();

  // ç©ºç™½æ ¼
  for(let i=0;i<firstDay;i++){
    calendar.innerHTML += "<div></div>";
  }

  for(let day=1; day<=daysInMonth; day++){

    let dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;

    let dayEvents = data.filter(item => item.updated === dateStr);

    let highlightClass = dayEvents.length > 0 ? "highlight" : "";

    let today = new Date();
    let todayStr = today.toISOString().split('T')[0];
    let todayClass = (dateStr === todayStr) ? "today" : "";

    calendar.innerHTML += `
      <div class="day ${highlightClass} ${todayClass}"
           onclick="showEvents('${dateStr}')">
        ${day}
      </div>
    `;
  }
}

function showEvents(dateStr){

  let dayEvents = data.filter(item => item.updated === dateStr);

  const events = document.getElementById('events');

  if(dayEvents.length === 0){
    events.innerHTML = "å½“å¤©æ²¡æœ‰æ›´æ–°";
    return;
  }

  events.innerHTML = "<h3>ðŸ“Œ å½“å¤©æ›´æ–°ï¼š</h3>";

  dayEvents.forEach(item=>{
    events.innerHTML += `
      <p>
        <a href="${item.link}" style="color:#60a5fa;">
          ${item.title}
        </a>
        â€” ${item.desc}
      </p>
    `;
  });
}

</script>

</body>
</html>
